# Observability and Monitoring

Maps to the following post in [Build Your Own LinkedIn Analytics](https://www.yzouyang.com/category/blog-series/build-your-own-linkedin-analytics/): 
- [Part 10: Observing the Pipeline](https://www.yzouyang.com/build-your-own-linkedin-analytics-part-10-observing-the-pipeline/)

## What to monitor
- Job run status and durations (success/failure rates)
- Row counts and data freshness for critical gold tables
- Error rates and exceptions in ingestion/transformation notebooks
- Quality monitor outputs for bronze/silver/gold tables (freshness and volume trends)

## Where to capture metrics
- Databricks Job run history and run logs
- Lakehouse Monitoring assets generated by quality monitors
- A monitoring table inside the `gold` catalog (e.g., `etl_monitoring.job_runs`)

## Recommended alerts
- Alert on job failures (immediate) via email notifications
- Alert on data freshness lag (e.g., if today's partition is missing)
- Alert on sudden drops or spikes in row counts for key tables
- Alert on monitor schedule failures (quality monitor runs)

## Debugging tips
- Re-run failed notebook tasks with the same parameters to reproduce
- Inspect job logs (driver/executor logs) for stack traces
- Query intermediate bronze/silver tables to check for data anomalies
- Review quality monitor assets in the workspace monitoring folder when checks fail

## Example SQL checks
- Missing partition check: `SELECT date FROM <gold_table> WHERE date = current_date()`
- Row-count anomaly: compare recent daily counts to historical averages

## Configuration
- `resources/monitoring.yml` defines quality monitors for bronze/silver/gold tables.
- Monitors run daily on staggered schedules (UTC) and write assets under `var.monitoring_folder`.
- Email notifications route to `var.support_email` for monitor failures.

## Variables
- `support_email`: email address for job/monitor failure notifications.
- `monitoring_folder`: workspace folder for Lakehouse Monitoring assets.
- `warehouse_id`: SQL warehouse used by the quality monitors.

## Reference
- `resources/jobs.yml` configures retry policies and job failure notifications.
